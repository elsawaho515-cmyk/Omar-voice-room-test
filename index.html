<!DOCTYPE html>
<html>
<head>
    <title>Voice Room - Animated Style</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
    
    <style>
        /* ------------------------------------- */
        /* Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø§Ù…Ø© */
        /* ------------------------------------- */
        body { 
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            font-family: 'Cairo', sans-serif;
            text-align: center;
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
            position: relative;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ±Ø§ Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ø§Ù„Ø®Ù„ÙÙŠØ©) */
        @keyframes aurora-animate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© Ù…ØªØ­Ø±ÙƒØ© */
            background: linear-gradient(-45deg, #0f4c75, #1a3c40, #0c2b3e, #0e2735);
            background-size: 400% 400%;
            animation: aurora-animate 20s ease infinite; /* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø±ÙƒØ© */
            z-index: -2;
        }
        
        /* ------------------------------------- */
        /* Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ ÙˆØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ (Pulsing Effect) */
        /* ------------------------------------- */

        /* Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø¨Ø¶ Ù„Ù„Ù…ØªØ­Ø¯Ø«ÙŠÙ† */
        @keyframes pulse-ring {
            0% { transform: scale(0.3); opacity: 0.7; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .seat-grid-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 30px;
            overflow-y: auto;
        }
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px 10px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø±Ø£Ø³ÙŠ */
            max-width: 95%;
        }
        .seat {
            position: relative;
            width: 70px; /* Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .seat:hover {
            transform: scale(1.05);
        }

        /* Ø±Ù…Ø² Ø§Ù„Ù…Ø§ÙŠÙƒ Ø§Ù„Ø£Ù†ÙŠÙ‚ (Ø¨Ø¯Ù„ Ø§Ù„ÙƒØ±Ø³ÙŠ) */
        .seat-icon {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.1); /* Ù„ÙˆÙ† Ø´Ø¨Ù‡ Ø´ÙØ§Ù */
            border: 2px solid gold; 
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); /* Ø¸Ù„ Ø®ÙÙŠÙ */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø§Ù„Ù†Ø¨Ø¶ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ */
        }

        .seat-icon::before {
            content: 'ğŸ™ï¸'; /* Ø±Ù…Ø² Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø¬Ø¯ÙŠØ¯ */
            font-size: 2.2em;
            position: absolute;
            z-index: 2;
            transition: all 0.3s;
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‚Ø¹Ø¯ Ø§Ù„Ù…Ø´ØºÙˆÙ„/Ø§Ù„Ù…ØªØ­Ø¯Ø« (Holo Effect) */
        .seat.occupied .seat-icon {
            border-color: #2ecc71; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ø­ÙŠÙˆÙŠ */
            box-shadow: 0 0 15px #2ecc71, 0 0 5px #27ae60; /* ØªØ£Ø«ÙŠØ± Ù‡Ø§Ù„Ø© Ø®Ø¶Ø±Ø§Ø¡ */
        }
        .seat.occupied .seat-icon::before {
            content: 'ğŸ”Š'; /* Ø±Ù…Ø² ØµÙˆØª */
            filter: drop-shadow(0 0 3px white);
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ù„Ù„Ù…ØªØ­Ø¯Ø« */
        .seat.occupied::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #2ecc71;
            z-index: 1;
            animation: pulse-ring 1.5s infinite; /* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ø¨Ø¶ */
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
        .seat-number {
            position: absolute;
            bottom: -5px; 
            font-size: 0.8em;
            color: #f1c40f; /* Ù„ÙˆÙ† Ø£ØµÙØ± ÙˆØ§Ø¶Ø­ */
            font-weight: bold;
            padding: 2px 5px;
            background: #34495e; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ù„Ù„ÙˆØ¶ÙˆØ­ */
            border-radius: 5px;
            z-index: 3;
        }

        /* ------------------------------------- */
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø£Ø³ ÙˆØ¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… (Ø£ÙƒØ«Ø± Ø­Ø¯Ø©) */
        /* ------------------------------------- */
        .header-bar {
            /* Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø·ÙÙŠÙØ© */
            background: rgba(0, 0, 0, 0.6);
        }
        .go-btn {
            background-color: #e74c3c; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø±/Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¨Ø§Ø±Ø² */
            padding: 5px 15px;
            border-radius: 25px;
            box-shadow: 0 0 10px #e74c3c;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠ */
        .footer-controls {
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid #34495e;
        }
        .control-btn {
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
            transition: background-color 0.2s;
        }
        .control-btn:active {
            transform: scale(0.95);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… ÙˆØ§Ù„Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        #join-btn { background-color: #2ecc71 !important; } /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… */
        #leave-btn { background-color: #e74c3c !important; } /* Ø£Ø­Ù…Ø± Ù„Ù„Ù…ØºØ§Ø¯Ø±Ø© */

        /* Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø© (LOG) */
        #log {
            top: 75px;
            background: rgba(44, 62, 80, 0.8);
            border: 1px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="background-container"></div>
    
    <div class="header-bar">
        <div class="header-left">
            <div class="go-btn">Go ></div>
            <div class="room-info">NON WIN <span id="win-amount">120000</span> in Wild Party</div>
        </div>
        <div class="header-right">
            <span>ğŸ‡°ğŸ‡¸Ãƒ</span>
            <span id="user-id-display">563442360</span>
            <div style="width: 20px; height: 20px; background-color: gold; border-radius: 50%; margin-left: 5px;"></div>
        </div>
    </div>
    
    <div class="seat-grid-container">
        <div class="seat-grid" id="remote-users-container">
            </div>
    </div>
    
    <div class="chat-announcement-area">
        <div class="announcement-box" style="text-align: left;"><p><span style="color: red; font-weight: bold;">Ù‡Ù€Ù†Ù€Ù€ÙŠÙ€Ù€Ø¦Ù€Ø§Ù‹ Ù„Ù€Ù€Ùƒ:</span> <span class="announcement-highlight">...K$Ãƒ</span> <span style="color: #2ecc71;">ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©</span></p></div>
        <div class="announcement-box"><p style="color: #e74c3c; font-weight: bold;">Ø¨Ø§Ù„Ø¥Ø¨Ø§Ø­ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¹Ù†Ù Ø£Ùˆ Ø§Ù„Ù…Ù…Ù†ÙˆØ¹!</p></div>
    </div>

    <div class="footer-controls">
        <div style="display: flex;">
            <div style="width: 50px; height: 50px; border-radius: 10px; background: #3498db; margin-right: 10px; box-shadow: 0 0 10px #3498db;">
            </div>
            <button id="join-btn" class="control-btn">JOIN</button>
            <button id="leave-btn" class="control-btn" disabled style="display: none;">LEAVE</button>
        </div>
        <div style="display: flex;">
            <div class="control-btn">ğŸ’¬</div>
            <div class="control-btn">ğŸ</div>
            <div class="control-btn">ğŸ®</div>
        </div>
    </div>

    <div id="log">Status: Ready.</div>

    <script>
        // **********************************************
        // ÙƒÙˆØ¯ AGORA RTC (Ù„Ù… ÙŠØªØºÙŠØ±)
        // **********************************************
        const APP_ID = '7256e10dce5849638ed0480404c0e815'; 
        const CHANNEL_NAME = 'main_room';
        const TOKEN = null;
        const MAX_SEATS = 20;

        let client = null;
        let localAudioTrack = null;
        const remoteUsers = {}; 

        // -------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (DOM)
        // -------------------------------------

        function buildSeats() {
            const container = document.getElementById('remote-users-container');
            for (let i = 1; i <= MAX_SEATS; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.id = `seat-${i}`;
                seat.setAttribute('data-uid', '');
                
                const icon = document.createElement('div');
                icon.className = 'seat-icon';
                seat.appendChild(icon);

                const number = document.createElement('div');
                number.className = 'seat-number';
                number.innerText = i;
                seat.appendChild(number);

                container.appendChild(seat);
            }
        }

        function findAndOccupySeat(uid) {
            for (let i = 1; i <= MAX_SEATS; i++) {
                const seat = document.getElementById(`seat-${i}`);
                if (!seat.getAttribute('data-uid')) {
                    seat.setAttribute('data-uid', uid);
                    seat.classList.add('occupied');
                    return seat;
                }
            }
            return null;
        }

        function freeSeat(uid) {
            const seat = document.querySelector(`.seat[data-uid="${uid}"]`);
            if (seat) {
                seat.setAttribute('data-uid', '');
                seat.classList.remove('occupied');
                seat.classList.remove('local-user');
            }
        }


        // -------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù AGORA
        // -------------------------------------

        function initializeClient() {
            client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
            setupEventListeners();
        }

        function setupEventListeners() {
            client.on("user-published", async (user, mediaType) => {
                await client.subscribe(user, mediaType);
                if (mediaType === "audio") {
                    user.audioTrack.play();
                    remoteUsers[user.uid] = user;
                    findAndOccupySeat(user.uid);
                    document.getElementById('log').innerText = `Status: User ${user.uid} joined and is talking.`;
                }
            });

            client.on("user-unpublished", (user) => {
                delete remoteUsers[user.uid];
                freeSeat(user.uid);
                document.getElementById('log').innerText = `Status: User ${user.uid} left.`;
            });
        }

        async function joinChannel() {
            if (!client) initializeClient();
            document.getElementById('log').innerText = `Status: Attempting to join...`;
            
            document.getElementById('join-btn').style.display = 'none';
            document.getElementById('leave-btn').style.display = 'flex';
            document.getElementById('leave-btn').disabled = true;

            try {
                const uid = await client.join(APP_ID, CHANNEL_NAME, TOKEN, null);
                localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
                await client.publish([localAudioTrack]);
                
                const localSeat = findAndOccupySeat(uid);
                if(localSeat) {
                    localSeat.classList.add('local-user');
                    document.getElementById('user-id-display').innerText = uid;
                }

                document.getElementById('log').innerText = `Status: Joined channel with UID ${uid}.`;
                document.getElementById('leave-btn').disabled = false;
            } catch (error) {
                console.error(error);
                document.getElementById('log').innerText = `Status: ERROR joining call. Check logs.`;
                document.getElementById('join-btn').style.display = 'flex';
                document.getElementById('leave-btn').style.display = 'none';
            }
        }

        async function leaveChannel() {
            if (localAudioTrack) {
                localAudioTrack.close();
                localAudioTrack = null;
            }
            if (client) {
                await client.leave();
                const localUid = client._uid; 
                if (localUid) freeSeat(localUid);
                
                document.getElementById('log').innerText = `Status: Left channel.`;
                document.getElementById('join-btn').style.display = 'flex';
                document.getElementById('leave-btn').style.display = 'none';
            }
        }

        // -------------------------------------
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // -------------------------------------
        document.getElementById('join-btn').onclick = joinChannel;
        document.getElementById('leave-btn').onclick = leaveChannel;
        
        buildSeats();
        initializeClient(); 
    </script>
</body>
</html>
